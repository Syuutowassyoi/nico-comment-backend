<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ニコニコ動画 コメント数モニター</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: #f0f0f0;
    }
    h1 {
      font-size: 3em;
      margin-bottom: 0.3em;
      color: #333;
    }
    .latest-count {
      font-size: 4em;
      color: #e91e63;
      margin: 0.2em 0 0.5em;
    }
    .update-time {
      font-size: 1.2em;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>コメント数</h1>
  <div class="latest-count" id="latest-count">読み込み中...</div>
  <div class="update-time" id="update-time">--:--:--</div>

  <script>
    async function updateCommentCount() {
      try {
        const res = await fetch("https://nico-comment-backend-production.up.railway.app/data");
        const data = await res.json();
        const latest = data[data.length - 1];
        document.getElementById("latest-count").textContent = latest.count.toLocaleString();
        const now = new Date();
        document.getElementById("update-time").textContent = now.toLocaleTimeString();
      } catch (e) {
        document.getElementById("latest-count").textContent = "取得失敗";
      }
    }

    // 秒が00になったらスタート、以降毎分更
    function startMinuteSyncUpdate() {
      const now = new Date();
      const delay = 60000 - (now.getSeconds() * 1000 + now.getMilliseconds());
      setTimeout(() => {
        updateCommentCount();
        setInterval(updateCommentCount, 60000);
      }, delay);
    }

    // 最初に即実行してから、00秒ごとのループへ
    updateCommentCount();
    startMinuteSyncUpdate();
  </script>
</body>
</html>
